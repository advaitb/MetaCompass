"""
DESCRIPTION
"""
#__author__ = "Victoria Cepeda

configfile: "config.json"
#iinclude_prefix="https://bitbucket.org/johanneskoester/snakemake-workflows/raw/master"
#parse fasta/fastq files, run methaphyler and create fasta reference file #
include:
    "metaphyler_selection.py"
#map reads against reference genomes
include:
    "mapping.py"

#build contigs using sam file
include:
    "build.py"

#map reads against contigs
include:
    "prepare_correction.py"

#correct references with pilon

#include:
#    "pilon.py"

#include:
#    include_prefix + "/bio/ngs/rules/mapping/samfiles.rules"

#log='Snakemake.log'
onsuccess:
    print("Workflow finished, no error")
onerror:
    print("An error occurred")
    #shell("mail -s an error occurred vcepeda@cs.umd.edu < log")

rule all:
    input:expand('{sample}.assembly.out/mc.refseq.fna',sample=config["reads"]["S1"]), 
    	  expand('{sample}.assembly.out/{sample}.sam',sample=config["reads"]["S1"]),
          expand('{sample}.assembly.out/contigs.fasta',sample=config["reads"]["S1"]),
	  expand('{sample}.pilon/{sample}.sorted.bam.bai',sample=config["reads"]["S1"])
          #expand('{sample}.pilon/{sample}.index.{index}.bt2', sample=config["reads"]["S1"], index=range(1,5) )
  #        expand("{sample}.pilon/{sample}.index.rev.{index}.bt2",sample=config["reads"]["S1"], index=range(1,3))
          #expand('{sample}.genomes/NC_000915.1_0.fasta',sample=config["reads"]["S1"])

          #expand('{sample}.genomes',sample=config["reads"]["S1"])
	  #expand('{sample}.pilon/{sample}.output.log',sample=config["reads"]["S1"])
#    params:"-q workstation -l mem=8gb,walltime=12:00:00"
